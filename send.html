<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Send Package | DM Xpress</title>
</head>
<body style="font-family:sans-serif;text-align:center;padding:2em;">
  <h2>üì§ Send a Package</h2>
  <form id="packageForm">
    <input type="text" placeholder="Package Description" id="desc" required><br><br>
    <input type="number" placeholder="Weight (lbs)" id="weight" required><br><br>
    <input type="text" placeholder="Destination Country" id="dest" required><br><br>
    <button type="button" onclick="calculateCost()">Calculate Cost</button>
  </form>

  <div id="costDetails" style="margin-top:2em; display:none;">
    <h3>üí∞ Cost Breakdown</h3>
    <p id="baseCost"></p>
    <p id="tax"></p>
    <p id="total"></p>
    <button onclick="makePayment()">Pay Now</button>
  </div>

  <div id="result" style="margin-top:2em; display:none;">
    <h3>‚úÖ Payment Received!</h3>
    <p><strong>Your Tracking Code:</strong> <span id="trackingCode">DMX2105526862</span></p>
    <div id="printArea">
      <img src="tracking_qr.png" alt="QR Code" width="200" height="200" />
      <p style="font-weight:bold;">Tracking Code: DMX2105526862</p>
    </div>
    <br>
    <button onclick="window.print()">üñ®Ô∏è Print QR & Tracking Code</button>
  </div>

  <!-- Firebase App & Firestore -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDi-eKOhhM0iBztwH-lk6xB8G_wCJIANxI",
      authDomain: "dm-xpress-1f835.firebaseapp.com",
      projectId: "dm-xpress-1f835",
      storageBucket: "dm-xpress-1f835.firebasestorage.app",
      messagingSenderId: "27426777557",
      appId: "1:27426777557:web:9b89da634b89ee6e55755c",
      measurementId: "G-VPBTR5RZ32"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let finalTotal = 0;

    function calculateCost() {
      const weight = parseFloat(document.getElementById("weight").value);
      if (isNaN(weight) || weight <= 0) {
        alert("Please enter a valid weight.");
        return;
      }

      const baseRate = 5.0;
      const fee = 3.0;
      const taxRate = 0.08;

      const subtotal = weight * baseRate + fee;
      const tax = subtotal * taxRate;
      finalTotal = subtotal + tax;

      document.getElementById("baseCost").innerText = "üì¶ Base Cost + Fee: $" + subtotal.toFixed(2);
      document.getElementById("tax").innerText = "üßæ Tax (8%): $" + tax.toFixed(2);
      document.getElementById("total").innerText = "üí≥ Total Amount Due: $" + finalTotal.toFixed(2);

      document.getElementById("costDetails").style.display = "block";
    }

    function makePayment() {
      const desc = document.getElementById("desc").value;
      const weight = parseFloat(document.getElementById("weight").value);
      const dest = document.getElementById("dest").value;
      const trackCode = document.getElementById("trackingCode").textContent;

      db.collection("packages").add({
        description: desc,
        weight: weight,
        destination: dest,
        total: finalTotal,
        trackingCode: trackCode,
        createdAt: new Date()
      }).then(() => {
        alert("Package saved successfully!");
        document.getElementById("result").style.display = "block";
        document.getElementById("costDetails").style.display = "none";
      }).catch((error) => {
        alert("Error saving to Firebase: " + error.message);
      });
    }
  </script>
</body>
</html>
